{
  "name": "Ray AI ç®¡å®¶ â€” é»å­æ”¶é›†",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"],
        "additionalFields": {}
      },
      "id": "tg-trigger-001",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [0, 300],
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Ray AI ç®¡å®¶ Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": false, "leftValue": "" },
          "conditions": [
            {
              "id": "filter-length",
              "leftValue": "={{ $json.message.text.length }}",
              "rightValue": 5,
              "operator": { "type": "number", "operation": "gt" }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "filter-001",
      "name": "Filter Short Messages",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [220, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "x-api-key", "value": "={{ $credentials.httpHeaderAuth.value }}" },
            { "name": "anthropic-version", "value": "2023-06-01" },
            { "name": "content-type", "value": "application/json" }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ model: 'claude-haiku-4-5-20251001', max_tokens: 500, system: 'ä½ æ˜¯ Ray çš„ AI ç®¡å®¶ã€‚åˆ†æä½¿ç”¨è€…å‚³ä¾†çš„æƒ³æ³•æˆ–é»å­ï¼Œå›å‚³ JSON æ ¼å¼ï¼ˆä¸è¦ markdown code blockï¼Œåªå›å‚³ç´” JSONï¼‰ï¼š\\n{\\n  \"title\": \"æƒ³æ³•æ‘˜è¦ï¼ˆç¹é«”ä¸­æ–‡ï¼Œ30å­—å…§ï¼‰\",\\n  \"type\": \"å¾ä»¥ä¸‹é¸ä¸€å€‹æœ€é©åˆçš„ï¼šğŸ’° è³£éŒ¢é»å­ / ğŸ“¹ å½±ç‰‡é»å­ / ğŸ› ï¸ å·¥å…·/è‡ªå‹•åŒ– / ğŸ“ å…§å®¹é»å­ / ğŸŒŸ äººç”Ÿç›®æ¨™ / ğŸ¤” å…¶ä»–\",\\n  \"priority\": \"å¾ä»¥ä¸‹é¸ä¸€å€‹ï¼šğŸ”¥ é«˜ / â­ ä¸­ / ğŸ“Œ ä½\",\\n  \"notes\": \"åŸå§‹è¨Šæ¯å…¨æ–‡ + ä½ çš„ç°¡çŸ­åˆ†æï¼ˆç‚ºä»€éº¼é€™å€‹æƒ³æ³•æœ‰åƒ¹å€¼ã€å»ºè­°ä¸‹ä¸€æ­¥è¡Œå‹•ï¼‰\"\\n}\\nåªå›å‚³ JSONï¼Œä¸è¦ä»»ä½•å…¶ä»–æ–‡å­—ã€‚', messages: [{ role: 'user', content: $json.message.text }] }) }}",
        "options": {
          "response": { "response": { "responseFormat": "json" } }
        }
      },
      "id": "claude-001",
      "name": "Claude Analyze Idea",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [440, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ANTHROPIC_CREDENTIAL_ID",
          "name": "Anthropic API Key"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse Claude response â†’ extract JSON from content\nconst content = $input.first().json;\nlet text = '';\nif (content.content && content.content[0] && content.content[0].text) {\n  text = content.content[0].text;\n}\n\n// Remove markdown code block if present\ntext = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n\ntry {\n  const parsed = JSON.parse(text);\n  return [{\n    json: {\n      title: parsed.title || 'æœªåˆ†é¡æƒ³æ³•',\n      type: parsed.type || 'ğŸ¤” å…¶ä»–',\n      priority: parsed.priority || 'â­ ä¸­',\n      notes: parsed.notes || $('Telegram Trigger').first().json.message.text,\n      chatId: $('Telegram Trigger').first().json.message.chat.id,\n      date: new Date().toISOString().split('T')[0]\n    }\n  }];\n} catch (e) {\n  // Fallback: save raw message\n  return [{\n    json: {\n      title: $('Telegram Trigger').first().json.message.text.substring(0, 30),\n      type: 'ğŸ¤” å…¶ä»–',\n      priority: 'â­ ä¸­',\n      notes: $('Telegram Trigger').first().json.message.text,\n      chatId: $('Telegram Trigger').first().json.message.chat.id,\n      date: new Date().toISOString().split('T')[0]\n    }\n  }];\n}"
      },
      "id": "code-parse-001",
      "name": "Parse Claude Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 300]
    },
    {
      "parameters": {
        "resource": "page",
        "operation": "create",
        "databaseId": { "__rl": true, "value": "ed035c908cc04b7b999ef0c023557add", "mode": "id" },
        "title": "={{ $json.title }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "é¡å‹|select",
              "selectValue": "={{ $json.type }}"
            },
            {
              "key": "ç‹€æ…‹|select",
              "selectValue": "ğŸ’¡ æ–°æƒ³æ³•"
            },
            {
              "key": "å„ªå…ˆåº¦|select",
              "selectValue": "={{ $json.priority }}"
            },
            {
              "key": "å»ºç«‹æ—¥æœŸ|date",
              "dateValue": "={{ $json.date }}"
            },
            {
              "key": "å‚™è¨»|rich_text",
              "textContent": "={{ $json.notes }}"
            }
          ]
        }
      },
      "id": "notion-create-001",
      "name": "Save to Notion Ideas",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [880, 300],
      "credentials": {
        "notionApi": {
          "id": "NOTION_CREDENTIAL_ID",
          "name": "Notion Integration"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Parse Claude Response').first().json.chatId }}",
        "text": "={{ 'âœ… å·²å­˜å…¥ Notionï¼\\n\\nğŸ“Œ ' + $('Parse Claude Response').first().json.title + '\\nğŸ·ï¸ ' + $('Parse Claude Response').first().json.type + ' Â· ' + $('Parse Claude Response').first().json.priority }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "tg-reply-001",
      "name": "Reply Confirmation",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1100, 300],
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Ray AI ç®¡å®¶ Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Parse Claude Response').first().json.chatId }}",
        "text": "âš ï¸ å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚\n\nå·²å‚™ä»½åŸå§‹è¨Šæ¯ï¼Œä¸æœƒéºå¤±ã€‚",
        "additionalFields": {}
      },
      "id": "tg-error-001",
      "name": "Error Reply",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1100, 500],
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Ray AI ç®¡å®¶ Bot"
        }
      }
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [[{ "node": "Filter Short Messages", "type": "main", "index": 0 }]]
    },
    "Filter Short Messages": {
      "main": [[{ "node": "Claude Analyze Idea", "type": "main", "index": 0 }]]
    },
    "Claude Analyze Idea": {
      "main": [[{ "node": "Parse Claude Response", "type": "main", "index": 0 }]]
    },
    "Parse Claude Response": {
      "main": [[{ "node": "Save to Notion Ideas", "type": "main", "index": 0 }]]
    },
    "Save to Notion Ideas": {
      "main": [[{ "node": "Reply Confirmation", "type": "main", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": [{ "name": "telegram" }, { "name": "notion" }, { "name": "ai" }],
  "triggerCount": 1,
  "pinData": {}
}
